<!DOCTYPE html>
<html lang="en" class="spf-link no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>SPF - Versioning</title>
<meta name="description" content="Automatically update script and style versions.">

<link rel="canonical" href="http://youtube.github.io/spfjs/documentation/versioning/">

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="196x196" href="/spfjs/images/touch/chrome-touch-icon-196x196.png">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="SPF">

<!-- Tile icon for Win8 (144x144 + tile color) -->
<meta name="msapplication-TileImage" content="/spfjs/images/touch/ms-touch-icon-144x144-precomposed.png">
<meta name="msapplication-TileColor" content="#3372DF">

<!-- begin spf head -->
<link rel="stylesheet" name="roboto" href="//fonts.googleapis.com/css?family=Roboto:300,600,900|Roboto+Condensed:300,300italic,400,700|Inconsolata:400">
<link rel="stylesheet" name="wsk" href="/spfjs/assets/vendor/wsk/0.4.0/styles/wsk.css">
<link rel="stylesheet" name="octicons" href="/spfjs/assets/vendor/octicons/2.1.2/octicons.css">
<link rel="stylesheet" name="main" href="/spfjs/assets/styles/main.css?t=2015-05-21T14%3A11%3A39-04%3A00">

<!-- end spf head -->
</head>
<body id="body" class="documentation">

<header id="app-bar" class="app-bar promote-layer">
  <div class="app-bar-container">
    <button id="menu" class="menu" title="Menu"></button>
    <h1 class="logo"><a href="/spfjs/">SPF</a></h1>
    <section class="app-bar-actions">
      <a href="#"><i class="icon octicon octicon-chevron-up"></i> Top</a>
    </section>
  </div>
</header>

<div class="navdrawer">
  <nav id="nav" class="navdrawer-container promote-layer">
    <h4>Navigation</h4>
    
<ul>
  
    <li class="index">
      <a href="/spfjs/">SPF</a>
    </li>
  
    <li >
      <a href="/spfjs/documentation/">Documentation</a>
    </li>
  
    <li >
      <a href="/spfjs/api/">API</a>
    </li>
  
    <li >
      <a href="/spfjs/download/">Download</a>
    </li>
  
  <li><a href="https://github.com/youtube/spfjs">GitHub</a></li>
</ul>

  </nav>
</div>

<div id="content">
<!-- begin spf body: content -->
<main class="clear">

  <nav class="toc g-wide--1 g-medium--1">
    
  
  
  
    <p class="toc__title">
      <a href="/spfjs/documentation/">Documentation</a>
    </p>
  

<ol class="toc__list list-links">
  
    <li>
      
        <a href="/spfjs/documentation/start/">Get Started</a>
      
      
    </li>
  
    <li>
      
        <a href="/spfjs/documentation/responses/">Responses</a>
      
      
    </li>
  
    <li>
      
        <a href="/spfjs/documentation/events/">Events</a>
      
      
    </li>
  
    <li>
      
        <a href="/spfjs/documentation/resources/">Resources</a>
      
      
    </li>
  
    <li>
      
        <a href="/spfjs/documentation/versioning/">Versioning</a>
      
      
    </li>
  
    <li>
      
        <a href="/spfjs/documentation/features/">Features</a>
      
      
        
  
  
  

<ol class="toc__list list-links">
  
    <li>
      
        <a href="/spfjs/documentation/features/caching/">Caching</a>
      
      
    </li>
  
    <li>
      
        <a href="/spfjs/documentation/features/multipart/">Multipart Responses</a>
      
      
    </li>
  
    <li>
      
        <a href="/spfjs/documentation/features/prefetching/">Prefetching</a>
      
      
    </li>
  
</ol>

      
    </li>
  
</ol>

  </nav>

  
  

  

    <article class="g-wide--3 g-wide--last g-medium--2 g-medium--last">
      <header class="page-header container">
        <h2 class="xxlarge text-divider">Versioning</h2>
        
          <p class="page-header__excerpt g-wide--push-1 g-wide--pull-1">
            Automatically update script and style versions.
          </p>
        
      </header>
      <div class="container">
        <p>When using dynamic navigation, SPF transforms your site from
short-lived pages into a long-lived application.  When building
a long-lived application, an important concern is how to push
new code -- you don&#39;t want old JS attempting to interact with new
HTML or new CSS applying to old HTML.  SPF can automatically
update your script and style versions to ensure they stay in
sync with your content.</p>

<blockquote>
<p><strong>Note:</strong> Automatic versioning only applies to
<a href="../resources/#managed-resources">managed resources</a>.</p>
</blockquote>

<p>As an example, consider a user currently on your site who
started with yesterday&#39;s code.  If you push updated scripts and
content, the user will transition to the new content and needs
the updated scripts as well.</p>

<h2 id="use-unique-urls-for-each-version">Use unique URLs for each version</h2>

<p>You can can instruct SPF to
<a href="../resources/#managed-resources">manage a resource</a> by giving it a <code>name</code>
attribute:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- external script --&gt;</span>
<span class="nt">&lt;script </span><span class="na">name=</span><span class="s">&quot;common&quot;</span> <span class="na">src=</span><span class="s">&quot;common-library.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="c">&lt;!-- inline script --&gt;</span>
<span class="nt">&lt;script </span><span class="na">name=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span><span class="cm">/* Page-specific script. */</span><span class="nt">&lt;/script&gt;</span>
<span class="c">&lt;!-- external style --&gt;</span>
<span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&quot;common&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;common-styles.css&quot;</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- inline style --&gt;</span>
<span class="nt">&lt;style </span><span class="na">name=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span><span class="c">/* Page-specific style. */</span><span class="nt">&lt;/style&gt;</span>
</code></pre></div>
<p>When navigating between pages, a named resource will only be
loaded once.  To detect updates, SPF tracks the external URL or
inline text associated with each resource name.  If when
processing response a changed URL or text is discovered, SPF
will unload the existing resource and load the new one.</p>

<p>To guarantee SPF switches between the old and new versions of
your scripts and styles, use a unique URL each time.  For
example, for the user currently on your site with yesterday&#39;s
code, they might have been served HTML like the following:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- old version --&gt;</span>
<span class="nt">&lt;script </span><span class="na">name=</span><span class="s">&quot;common&quot;</span> <span class="na">src=</span><span class="s">&quot;common-library-v1.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>
<p>Then, when you push updated scripts and content, update the URL
as well:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- new version --&gt;</span>
<span class="nt">&lt;script </span><span class="na">name=</span><span class="s">&quot;common&quot;</span> <span class="na">src=</span><span class="s">&quot;common-library-v2.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> SPF will automatically detect when the content of
managed inline scripts and styles are updated by tracking a
quick hash of the text content.  Whitespace is ignored when
calculating the hash, so indentation and formatting changes
will not trigger updates.</p>
</blockquote>

<h2 id="resource-events">Resource events</h2>

<p>If you need to handle resources being unloaded when a new
version is detected, (e.g. to dispose event listeners, etc), SPF
will dispatch events before and after a resource is removed.
As with those detailed in the <a href="../events/">Events</a> documentation,
these events are defined in the <a href="../../api/">API</a> as <a href="../../api/#spf.event">spf.Event</a>
objects.  The events and their descriptions follow:</p>

<p><strong><code>spfcssbeforeunload</code></strong><br>
Fired before unloading a managed style resource.  Occurs when
an updated style is discovered for a given name.</p>

<p><strong><code>spfcssunload</code></strong><br>
Fired when unloading a managed style resource.  If the style
is being unloaded as part of switching versions, unloading of
the old style occurs after the new style is loaded to avoid
flashes of unstyled content.</p>

<p><strong><code>spfjssbeforeunload</code></strong><br>
Fired before unloading a managed script resource.  Occurs when
an updated script is discovered for a given name.</p>

<p><strong><code>spfjsunload</code></strong><br>
Fired when unloading a managed script resource.  If the script
is being unloaded as part of switching versions, unloading of
the old script occurs after the new script is loaded for
consistency with style loading.</p>

      </div>
      

  






<nav class="article-nav">
  
    <a href="/spfjs/documentation/resources/" class="article-nav-link article-nav-link--prev">
      <p class="article-nav-count">Resources</p>
      
        <p class="article-nav-description">Manage script and style loading.</p>
      
    </a>
  
  
    <a href="/spfjs/documentation/features/" class="article-nav-link article-nav-link--next">
      <p class="article-nav-count">Features</p>
      
        <p class="article-nav-description">Learn about SPF features to enable high performance.</p>
      
    </a>
  
</nav>

    </article>

  


  <section class="feedback">
    <footer class="container"><div class="container">
      <p>
        If you have feedback, comments, or questions about SPF, please send them
        to <a href="mailto:spfjs@googlegroups.com">spfjs@googlegroups.com</a>.
        If you have bugs or feature requests, please file them on
        <a href="https://github.com/youtube/spfjs/issues">GitHub</a>. Join our
        <a href="https://groups.google.com/group/spfjs">mailing list</a> and
        follow <a href="https://twitter.com/spfjs">@spfjs</a> on Twitter for
        updates.
      </p>
    </div></footer>
  </section>

</main>

<!-- end spf body: content -->
</div>

<footer>
  <div class="container">
    <p class="small">
      &copy; 2014 Google.
      Code licensed under <a href="https://github.com/youtube/spfjs/blob/master/LICENSE">MIT</a>.
      Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.
    </p>
  </div>
</footer>

<div id="progress"><dt></dt><dd></dd></div>

<!-- begin spf foot -->
<script name="spf" src="/spfjs/assets/vendor/spf/2.1.1/spf.js"></script>
<script name="main" src="/spfjs/assets/scripts/main.js?t=2015-05-21T14%3A11%3A39-04%3A00"></script>

<script name="analytics">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
</script>
<script>
  if (window.location.hostname == 'youtube.github.io') {
    ga('create', 'UA-52278317-1', 'auto');
    ga('send', 'pageview');
  }
</script>

<!-- end spf foot -->
</body>
</html>
